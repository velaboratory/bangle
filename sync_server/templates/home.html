{% extends 'base.html' %}

{% block title %}Home - UGA Bangle Management{% endblock %}

{% block header %}UGA Bangle Management{% endblock %}

{% block content %}
    <h2>Devices</h2>
    
    <table id="deviceTable" class="display">
        <thead>
            <tr>
                <th>MAC Address</th>
                <th>Last Sync Time</th>
                <th>Last Sync App</th>
                <th>Current Target</th>
                <th>Select Target App</th>
                <th>Update</th>
            </tr>
        </thead>
        <tbody>
            {% for device in devices %}

                    
                    <tr>
                        <form action="/change_app" method="POST">
                            <input type="hidden" name="device_id" value="{{device.id}}"/>
                            <td>{{ device.id }}</td>
                            <td>{{ device.last_sync }}</td>
                            <td>{{ device.app_name }} v{{ device.app_version }}</td>
                            <td>{{ device.target_app_name}} v{{device.target_app_version}}</td>
                            <td><select id="selectApp" name="app_name">
                                {% for app in apps %}
                                    {% if app.name == device.target_app_name and app.version == device.target_app_version %}
                                    <option value="{{device.id}},{{app.name}},{{app.version}}" selected>{{app.name}} v{{app.version}}</option>
                                    {% else %}
                                    <option value="{{device.id}},{{app.name}},{{app.version}}">{{app.name}} v{{app.version}}</option>
                                    {% endif %}
                                {% endfor %}
                            </select></td>
                            <td><input type="submit" value="Update"></td>
                        </form>
                    </tr>
                
            {% endfor %}
        </tbody>
    </table>
       

    <script>
        $(document).ready(function() {
            $('#deviceTable').DataTable();
        });
    </script>
{% endblock %}